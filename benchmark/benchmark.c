#include <gmp.h>
#include <stdio.h>
#include <stdlib.h>
#include <time.h>

int main() {
    mpz_t n;
    mpz_init(n);

    // Set to some large n = pq where p and q are random strong 2048 bit primes
    mpz_set_str(
        n,
        "5495272697699768469417480373920149288428222437290955849637019057353679"
        "6716269697954597323048415502844406856276203464197276313094442296080800"
        "8410074738494589610270341766007969650840222440312607190683570006630043"
        "3996838444699876920628037549809382848297188457637944863201102473446980"
        "9403182861239302726330815333760211646446849095751516021573130458357037"
        "4257936296356721202403586768684062415002929273036592699172351841331595"
        "3831533819333729004583824201366521592525686755328447600931357670819360"
        "0478858480061956620838786472341605672491189130831221563324448357683581"
        "3013800888691989090753275785616582912002130124527732836531151477187290"
        "1768905291845145154965747848509292797212322713383219267522002991014041"
        "5703477128377236534950209584391664870565843424240948977148896516922898"
        "0220108104528261343816320342002404581220184461513583514639584818537131"
        "6908807399019414569476225984745124438436846537452026902960476176437722"
        "8073356460468153367359928576986590345299234191893061297311938793060458"
        "4733478517820179760929787307295726803686467609756338762336597596098797"
        "7701485348241984570061137870586128668022054333324349763436333881634428"
        "8463358174820693537676921372610248350278197945327938705427153222747161"
        "0982672987515902834718087873723745012286377",
        10);

    mpz_t a;
    mpz_init(a);
    mpz_set_ui(a, 2);

    const unsigned N = 0xfffff;

    while (1) {
        clock_t begin = clock();
        for (unsigned i = 0; i < N; i++) {
            mpz_powm_ui(a, a, 2, n);
        }
        clock_t end = clock();
        double seconds_elapsed = (double)(end - begin) / CLOCKS_PER_SEC;
        int ops_per_sec = N / seconds_elapsed;
        printf("Squarings per second: %d\n", (int)ops_per_sec);
    }

    mpz_clear(a);
    mpz_clear(n);
    return 0;
}